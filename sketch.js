var can_draw = true;
var global_strokes = []
var global_shapes = []

var sketchpad = Raphael.sketchpad("editor", {
    width: 800,
    height: 800,
    editing: true
});

function stroke_to_points(stroke) {
    var path = stroke.path;
    var points = path.split(/(?=[LMC])/)
    var result = []
    for (point of points) {
        point = point.slice(1).split(',')
        point[0] = parseInt(point[0])
        point[1] = parseInt(point[1])
        result.push(point)
    }
    return result
}

function get_paths(sketchpad) {
    paths = []
    for (stroke of sketchpad.strokes()) {
        points = stroke_to_points(stroke)
        paths.push(points)
    }
    return paths
}

function paths_to_pdollar(paths) {
    pointset = []
    for (path_id in paths) {
        path = paths[path_id]
        for (point of path) {
        pointset.push(new Point(x=point[0], y=point[1], id=path_id))
    }
    }
    return pointset
}
function points(points) {
    result = []
    for (point of points) {
        result.push('new Point(' + [point.X, point.Y, point.ID].join(', ') + ')')
    }
    console.log(result)
    return '[' + result.join(', ') + ']'
}

// When the sketchpad changes, update the input field.
sketchpad.change(function() {
    $("#data").val(sketchpad.json());
    points = get_paths(sketchpad);
    console.log(JSON.stringify(points))
    pdollar = paths_to_pdollar(points)
    shape = R.Recognize(pdollar)
    console.log(shape)
});

R = new PDollarRecognizer()

function example(name, points) {
    R.PointClouds.push(new PointCloud(name, paths_to_pdollar(points)))
}

example('relu', [[[59,235],[66,235],[95,235],[125,235],[153,235],[165,235],[167,235],[170,235],[187,235],[205,236],[226,238],[240,239],[249,241],[254,241],[259,241],[260,242],[261,242],[262,242],[262,242],[262,242],[263,240],[273,229],[293,211],[348,166],[368,150],[402,126],[431,106],[456,91],[482,78],[490,74],[506,66],[512,63],[516,61],[517,61],[518,60],[517,60]]])
example('relu', 
        [[[60,180],[59,180],[83,180],[142,180],[163,180],[170,180],[171,180],[172,179],[173,177],[182,170],[197,160],[218,149],[234,142],[258,132],[269,127],[274,125],[282,121],[287,119],[293,118],[294,117],[293,117]]])

example('circle', [[[178,54],[177,54],[172,55],[169,63],[164,74],[163,82],[162,92],[161,103],[159,114],[159,126],[159,135],[169,152],[195,166],[220,159],[252,129],[258,117],[259,93],[259,62],[256,54],[254,53],[249,50],[240,48],[233,46],[223,45],[218,45],[211,45],[203,45],[196,45],[187,47],[183,48],[182,49],[181,50],[180,51],[178,54],[176,56]]])

example('circle', [[[137,33],[139,33],[148,33],[163,33],[172,33],[177,35],[182,37],[188,41],[192,44],[198,50],[202,56],[205,62],[207,70],[208,75],[209,81],[210,86],[210,93],[210,96],[206,119],[197,134],[180,149],[159,158],[143,162],[130,162],[122,162],[116,162],[113,162],[107,162],[103,160],[99,156],[95,151],[91,144],[89,139],[86,132],[84,124],[82,118],[80,110],[79,103],[77,87],[77,76],[79,72],[87,63],[90,60],[92,58],[97,54],[98,53],[101,51],[103,50],[103,49],[104,49],[106,48],[109,46],[112,44],[114,42],[116,42],[116,42],[117,42],[119,41],[121,40],[122,39],[124,39],[124,39],[125,39],[125,39],[125,39],[126,38],[127,38],[130,37],[131,36],[133,36],[133,36],[134,36],[135,36],[136,36],[138,35],[138,35],[139,35],[139,35],[140,35],[140,35],[140,35],[141,35],[142,35],[143,35],[144,35]]])

example('sigmoid', [[[220,62],[220,62],[218,62],[216,62],[214,62],[212,62],[203,62],[192,63],[179,69],[173,74],[171,78],[171,80],[171,90],[171,104],[171,107],[171,114],[171,120],[172,126],[173,131],[175,137],[177,143],[185,162],[188,176],[188,188],[184,201],[174,215],[166,220],[160,222],[151,222],[138,222],[132,219],[121,214],[119,212]]])

example('square', [[[193,111],[193,111],[193,121],[193,135],[193,143],[193,152],[193,159],[193,208],[193,215],[192,230],[192,230],[192,231],[192,231],[193,231],[195,231],[198,230],[206,230],[214,230],[224,230],[235,230],[247,230],[267,230],[279,230],[294,231],[307,232],[319,233],[331,234],[338,235],[341,235],[342,235],[344,235],[344,235],[345,235],[346,235],[349,236],[349,236],[351,236],[351,236],[352,236],[352,236],[352,234],[352,231],[352,229],[352,223],[352,211],[352,191],[356,163],[358,145],[358,139],[359,124],[360,119],[360,113],[360,101],[361,93],[361,81],[361,75],[361,71],[361,69],[361,67],[361,66],[361,65],[360,65],[360,65],[359,65],[358,65],[356,65],[352,65],[346,65],[338,65],[326,65],[309,65],[297,65],[277,65],[260,62],[250,60],[240,58],[234,58],[226,58],[218,57],[210,57],[204,56],[199,55],[196,54],[193,54],[192,54],[191,54],[190,54],[190,54],[190,54],[190,54],[190,54],[190,54],[190,54],[190,55]]])

example('square', [[[176,65],[177,65],[197,65],[225,65],[242,65],[260,65],[283,65],[308,65],[316,66],[317,66],[317,67],[317,68],[317,74],[317,103],[316,139],[310,192],[303,227],[297,248],[295,255],[294,259],[294,260],[293,261],[291,260],[273,260],[216,258],[192,258],[180,258],[166,258],[161,258],[157,258],[155,258],[155,258],[155,258],[155,258],[155,256],[155,255],[155,254],[154,251],[153,247],[149,238],[139,203],[136,180],[134,150],[133,128],[133,114],[133,111],[133,106],[133,102],[133,101],[133,101],[133,100],[133,100],[133,97],[133,91],[133,86],[133,82],[133,79],[133,78],[133,78],[133,77],[133,77],[133,76],[133,74],[133,72],[133,69],[133,65],[133,63],[133,63],[133,63],[134,63],[134,62],[134,62],[134,62],[135,62],[135,62],[135,62],[135,63],[135,63],[135,63],[135,63],[135,64],[135,64],[135,64],[135,65],[135,65],[135,65],[135,65],[135,66],[135,66],[136,66]]])

example('plus', [[[243,96],[243,96],[243,101],[243,105],[243,110],[243,115],[243,119],[243,123],[243,129],[243,132],[243,136],[243,137],[243,138],[243,139],[243,140],[243,140],[243,142],[243,144],[243,145],[243,147],[243,152],[243,155],[243,158],[243,159],[243,160]],[[213,123],[216,123],[220,123],[224,123],[230,123],[233,123],[237,123],[243,123],[247,123],[251,123],[255,123],[258,123],[261,123],[265,123],[270,123],[272,123],[273,123],[274,123],[275,123],[275,123],[275,123]]])

// example('cdot', [[[220,66],[216,66],[207,67],[198,73],[192,78],[191,81],[190,83],[188,95],[188,109],[188,121],[190,128],[196,138],[204,150],[214,160],[227,168],[236,170],[254,170],[273,166],[286,160],[293,155],[298,147],[304,135],[308,121],[312,98],[312,81],[312,67],[309,60],[301,53],[295,51],[287,48],[277,45],[270,45],[264,45],[255,45],[253,45],[249,45],[247,46],[244,47],[242,47],[240,48],[237,49],[234,51],[229,53],[221,58],[219,60],[213,63],[211,65],[210,65],[208,66],[207,67],[207,67],[207,68]],[[243,105],[243,105],[243,105],[245,106],[248,107],[250,108],[250,109],[251,109],[252,109],[252,108],[252,106],[250,104],[249,102],[247,102],[246,101],[243,100],[240,99],[236,98],[234,97],[233,97],[232,97],[233,97],[236,101],[239,104],[242,107],[245,110],[247,111],[249,112],[250,113],[250,113],[251,113],[251,113],[250,111],[248,110],[246,109],[244,106],[242,104],[241,103],[241,103],[240,102],[240,102],[240,102]]])

// example('cdot', [[[216,90],[216,90],[217,88],[218,84],[219,82],[219,80],[219,79],[218,79],[217,79],[217,80],[216,81],[216,82],[216,82],[216,84],[216,85],[216,85],[216,86],[217,86],[217,86],[217,87],[217,87],[217,87],[218,87],[218,87],[218,87],[219,87]],[[216,40],[216,40],[215,40],[213,40],[212,40],[211,40],[209,42],[206,45],[203,49],[199,53],[190,61],[185,66],[181,68],[176,72],[175,73],[174,75],[172,76],[171,78],[170,80],[169,83],[169,86],[168,88],[168,91],[168,99],[168,106],[168,111],[169,116],[170,120],[172,123],[174,125],[176,127],[178,129],[181,131],[185,132],[190,134],[196,136],[209,137],[217,137],[224,137],[229,137],[233,137],[237,137],[241,135],[245,133],[249,131],[252,130],[254,128],[256,126],[258,123],[259,120],[260,117],[261,113],[261,107],[263,101],[265,93],[266,85],[267,78],[267,73],[267,69],[267,66],[267,64],[267,59],[266,56],[264,52],[262,49],[260,45],[258,43],[256,40],[253,38],[251,36],[248,35],[246,34],[243,33],[242,33],[240,33],[238,33],[236,33],[234,33],[233,34],[231,35],[230,36],[228,37],[227,38],[224,40],[223,41],[220,42],[218,43],[218,43],[217,43],[217,43],[216,43],[216,43],[216,43],[215,43],[214,43],[213,43],[212,43],[212,43],[211,43],[211,42],[211,42]]])

// example('cdot', [[[271,145],[273,145],[276,145],[279,145],[284,146],[289,153],[292,162],[296,175],[300,189],[300,201],[300,223],[298,235],[289,244],[274,249],[257,251],[248,250],[237,240],[231,230],[225,212],[224,191],[224,180],[226,172],[229,165],[237,155],[241,151],[244,149],[248,148],[257,147],[267,146],[269,146],[270,146],[270,146],[270,146],[272,146],[274,146],[274,146]],[[263,195],[263,195]]])

example('mul', [[[277,38],[276,38],[276,43],[276,76],[276,114],[276,134],[276,149],[274,156],[274,157],[273,157]],[[239,86],[239,86],[240,86],[244,86],[248,86],[249,86],[252,86],[256,86],[262,86],[271,86],[273,86],[278,86],[283,86],[287,86],[292,86],[297,86],[303,87],[307,88],[313,88],[319,88],[324,89],[328,90],[330,90],[330,90],[331,90]],[[307,60],[307,60],[306,61],[304,63],[302,64],[299,66],[297,68],[294,71],[289,74],[286,78],[282,82],[279,84],[276,86],[273,89],[269,92],[266,95],[263,99],[259,103],[255,108],[252,112],[250,114],[248,116],[246,117],[245,118],[245,119],[245,119]],[[258,55],[258,55],[258,56],[258,58],[258,59],[258,61],[259,63],[260,67],[264,71],[267,74],[271,78],[275,84],[277,89],[281,94],[283,97],[284,99],[286,100],[288,102],[289,104],[291,106],[293,108],[294,110],[296,111],[297,112],[297,113],[297,114],[296,112]]])

